package autoprob.katastruct;

import java.awt.*;
import java.util.List;

import autoprob.go.Intersection;
import autoprob.go.Node;
import com.google.gson.annotations.Expose;
import com.google.gson.annotations.SerializedName;

public class KataQuery {

	@SerializedName("id")
	@Expose
	public String id;
	@SerializedName("initialStones")
	@Expose
	public List<List<String>> initialStones = null;
	@SerializedName("moves")
	@Expose
	public List<List<String>> moves = null;

	@SerializedName("rules")
	@Expose
	public String rules = "tromp-taylor";

	@SerializedName("initialPlayer")
	@Expose
	public String initialPlayer = "B";
	
	@SerializedName("komi")
	@Expose
	public Double komi;
	
	public Boolean includeOwnership;
	public Boolean includeOwnershipStdev;
	public Boolean includeMovesOwnership;
	public Boolean includePolicy;

	@SerializedName("maxVisits")
	@Expose
	public Integer maxVisits;

	@SerializedName("boardXSize")
	@Expose
	public Integer boardXSize = 19;

	@SerializedName("boardYSize")
	@Expose
	public Integer boardYSize = 19;
	
	@SerializedName("analyzeTurns")
	@Expose
	public List<Integer> analyzeTurns = null;

	@SerializedName("allowMoves")
	@Expose
	public List<AllowMove> allowMoves = null;

	// overrideSettings (object): Optional. Specify any number of "paramName":value entries in this object to override those params from command line CONFIG_FILE for this query. Most search parameters can be overriden: cpuctExploration, winLossUtilityFactor, etc.
	// just support: humanSLProfile (string). Set the human-like play that KataGo should imitate.
	@SerializedName("overrideSettings")
	@Expose
	public OverrideSettings overrideSettings;

	public static class OverrideSettings {
		@SerializedName("humanSLProfile")
		@Expose
		public String humanSLProfile;
	}

    public Node generateNode() {
		Node n = new Node(null);
		// set board from initialStones
		for (List<String> stone : initialStones) {
			String color = stone.get(0);
			String loc = stone.get(1);
			Point p = Intersection.gtp2point(loc);
			if (color.equals("B")) {
				n.board.board[p.x][p.y].stone = Intersection.BLACK;
			}
			else {
				n.board.board[p.x][p.y].stone = Intersection.WHITE;
			}
		}
		// add any moves
		if (moves != null) {
			for (List<String> move : moves) {
				String color = move.get(0);
				String loc = move.get(1);
				Point p = Intersection.gtp2point(loc);
				if (color.equals("B")) {
					n.board.board[p.x][p.y].stone = Intersection.BLACK;
				} else {
					n.board.board[p.x][p.y].stone = Intersection.WHITE;
				}
			}
		}

		return n;
    }

	public String printMoves() {
		String s = "";
		if (moves != null) {
			for (List<String> move : moves) {
				s += move.get(0) + " " + move.get(1) + "\n";
			}
		}
		return s;
	}

	public void setHumanSLrank(String rank) {
		if (overrideSettings == null) {
			overrideSettings = new OverrideSettings();
		}
		overrideSettings.humanSLProfile = "preaz_" + rank;
	}
}